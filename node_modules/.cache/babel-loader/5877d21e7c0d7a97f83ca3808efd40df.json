{"ast":null,"code":"import _slicedToArray from\"/Users/lap14205/Documents/home/blockchain_learning/bscswap-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{AddressZero}from'@ethersproject/constants';import{Currency,CurrencyAmount,Fraction,JSBI,Percent,Token,TokenAmount,WETH}from'@bscswap/sdk';import React,{useCallback,useMemo,useState}from'react';import ReactGA from'react-ga';import{Redirect}from'react-router';import{Text}from'rebass';import{ButtonConfirmed}from'../../components/Button';import{LightCard,PinkCard,YellowCard}from'../../components/Card';import{AutoColumn}from'../../components/Column';import CurrencyLogo from'../../components/CurrencyLogo';import QuestionHelper from'../../components/QuestionHelper';import{AutoRow,RowBetween,RowFixed}from'../../components/Row';import{Dots}from'../../components/swap/styleds';import{DEFAULT_DEADLINE_FROM_NOW,INITIAL_ALLOWED_SLIPPAGE}from'../../constants';import{MIGRATOR_ADDRESS}from'../../constants/abis/migrator';import{PairState,usePair}from'../../data/Reserves';import{useTotalSupply}from'../../data/TotalSupply';import{useActiveWeb3React}from'../../hooks';import{useToken}from'../../hooks/Tokens';import{ApprovalState,useApproveCallback}from'../../hooks/useApproveCallback';import{useV1ExchangeContract,useV2MigratorContract}from'../../hooks/useContract';import{NEVER_RELOAD,useSingleCallResult}from'../../state/multicall/hooks';import{useIsTransactionPending,useTransactionAdder}from'../../state/transactions/hooks';import{useETHBalances,useTokenBalance}from'../../state/wallet/hooks';import{BackArrow,ExternalLink,TYPE}from'../../theme';import{getEtherscanLink,isAddress}from'../../utils';import{BodyWrapper}from'../AppBody';import{EmptyState}from'./EmptyState';var POOL_CURRENCY_AMOUNT_MIN=new Fraction(JSBI.BigInt(1),JSBI.BigInt(1000000));var WEI_DENOM=JSBI.exponentiate(JSBI.BigInt(10),JSBI.BigInt(18));var ZERO=JSBI.BigInt(0);var ONE=JSBI.BigInt(1);var ZERO_FRACTION=new Fraction(ZERO,ONE);var ALLOWED_OUTPUT_MIN_PERCENT=new Percent(JSBI.BigInt(10000-INITIAL_ALLOWED_SLIPPAGE),JSBI.BigInt(10000));function FormattedPoolCurrencyAmount(_ref){var currencyAmount=_ref.currencyAmount;return/*#__PURE__*/React.createElement(React.Fragment,null,currencyAmount.equalTo(JSBI.BigInt(0))?'0':currencyAmount.greaterThan(POOL_CURRENCY_AMOUNT_MIN)?currencyAmount.toSignificant(4):\"<\".concat(POOL_CURRENCY_AMOUNT_MIN.toSignificant(1)));}export function V1LiquidityInfo(_ref2){var token=_ref2.token,liquidityTokenAmount=_ref2.liquidityTokenAmount,tokenWorth=_ref2.tokenWorth,ethWorth=_ref2.ethWorth;var _useActiveWeb3React=useActiveWeb3React(),chainId=_useActiveWeb3React.chainId;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(AutoRow,{style:{justifyContent:'flex-start',width:'fit-content'}},/*#__PURE__*/React.createElement(CurrencyLogo,{size:\"24px\",currency:token}),/*#__PURE__*/React.createElement(\"div\",{style:{marginLeft:'.75rem'}},/*#__PURE__*/React.createElement(TYPE.mediumHeader,null,/*#__PURE__*/React.createElement(FormattedPoolCurrencyAmount,{currencyAmount:liquidityTokenAmount}),' ',token.equals(WETH[chainId])?'WETH':token.symbol,\"/BNB\"))),/*#__PURE__*/React.createElement(RowBetween,{my:\"1rem\"},/*#__PURE__*/React.createElement(Text,{fontSize:16,fontWeight:500},\"Pooled \",token.equals(WETH[chainId])?'WETH':token.symbol,\":\"),/*#__PURE__*/React.createElement(RowFixed,null,/*#__PURE__*/React.createElement(Text,{fontSize:16,fontWeight:500,marginLeft:'6px'},tokenWorth.toSignificant(4)),/*#__PURE__*/React.createElement(CurrencyLogo,{size:\"20px\",style:{marginLeft:'8px'},currency:token}))),/*#__PURE__*/React.createElement(RowBetween,{mb:\"1rem\"},/*#__PURE__*/React.createElement(Text,{fontSize:16,fontWeight:500},\"Pooled ETH:\"),/*#__PURE__*/React.createElement(RowFixed,null,/*#__PURE__*/React.createElement(Text,{fontSize:16,fontWeight:500,marginLeft:'6px'},/*#__PURE__*/React.createElement(FormattedPoolCurrencyAmount,{currencyAmount:ethWorth})),/*#__PURE__*/React.createElement(CurrencyLogo,{size:\"20px\",style:{marginLeft:'8px'},currency:Currency.ETHER}))));}function V1PairMigration(_ref3){var _useETHBalances,_v2Pair$reserveOf,_v1SpotPrice$invert,_v2SpotPrice$invert,_v1SpotPrice$invert2;var liquidityTokenAmount=_ref3.liquidityTokenAmount,token=_ref3.token;var _useActiveWeb3React2=useActiveWeb3React(),account=_useActiveWeb3React2.account,chainId=_useActiveWeb3React2.chainId;var totalSupply=useTotalSupply(liquidityTokenAmount.token);var exchangeETHBalance=(_useETHBalances=useETHBalances([liquidityTokenAmount.token.address]))===null||_useETHBalances===void 0?void 0:_useETHBalances[liquidityTokenAmount.token.address];var exchangeTokenBalance=useTokenBalance(liquidityTokenAmount.token.address,token);var _usePair=usePair(chainId?WETH[chainId]:undefined,token),_usePair2=_slicedToArray(_usePair,2),v2PairState=_usePair2[0],v2Pair=_usePair2[1];var isFirstLiquidityProvider=v2PairState===PairState.NOT_EXISTS;var v2SpotPrice=v2Pair===null||v2Pair===void 0?void 0:(_v2Pair$reserveOf=v2Pair.reserveOf(token))===null||_v2Pair$reserveOf===void 0?void 0:_v2Pair$reserveOf.divide(v2Pair===null||v2Pair===void 0?void 0:v2Pair.reserveOf(WETH[chainId]));var _useState=useState(false),_useState2=_slicedToArray(_useState,2),confirmingMigration=_useState2[0],setConfirmingMigration=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),pendingMigrationHash=_useState4[0],setPendingMigrationHash=_useState4[1];var shareFraction=totalSupply?new Percent(liquidityTokenAmount.raw,totalSupply.raw):ZERO_FRACTION;var ethWorth=exchangeETHBalance?CurrencyAmount.ether(exchangeETHBalance.multiply(shareFraction).multiply(WEI_DENOM).quotient):CurrencyAmount.ether(ZERO);var tokenWorth=exchangeTokenBalance?new TokenAmount(token,shareFraction.multiply(exchangeTokenBalance.raw).quotient):new TokenAmount(token,ZERO);var _useApproveCallback=useApproveCallback(liquidityTokenAmount,MIGRATOR_ADDRESS),_useApproveCallback2=_slicedToArray(_useApproveCallback,2),approval=_useApproveCallback2[0],approve=_useApproveCallback2[1];var v1SpotPrice=exchangeTokenBalance&&exchangeETHBalance?exchangeTokenBalance.divide(new Fraction(exchangeETHBalance.raw,WEI_DENOM)):null;var priceDifferenceFraction=v1SpotPrice&&v2SpotPrice?v1SpotPrice.divide(v2SpotPrice).multiply('100').subtract('100'):undefined;var priceDifferenceAbs=(priceDifferenceFraction===null||priceDifferenceFraction===void 0?void 0:priceDifferenceFraction.lessThan(ZERO))?priceDifferenceFraction===null||priceDifferenceFraction===void 0?void 0:priceDifferenceFraction.multiply('-1'):priceDifferenceFraction;var minAmountETH=v2SpotPrice&&tokenWorth?tokenWorth.divide(v2SpotPrice).multiply(WEI_DENOM).multiply(ALLOWED_OUTPUT_MIN_PERCENT).quotient:ethWorth===null||ethWorth===void 0?void 0:ethWorth.numerator;var minAmountToken=v2SpotPrice&&ethWorth?ethWorth.multiply(v2SpotPrice).multiply(JSBI.exponentiate(JSBI.BigInt(10),JSBI.BigInt(token.decimals))).multiply(ALLOWED_OUTPUT_MIN_PERCENT).quotient:tokenWorth===null||tokenWorth===void 0?void 0:tokenWorth.numerator;var addTransaction=useTransactionAdder();var isMigrationPending=useIsTransactionPending(pendingMigrationHash);var migrator=useV2MigratorContract();var migrate=useCallback(function(){if(!minAmountToken||!minAmountETH)return;setConfirmingMigration(true);migrator.migrate(token.address,minAmountToken.toString(),minAmountETH.toString(),account,Math.floor(new Date().getTime()/1000)+DEFAULT_DEADLINE_FROM_NOW).then(function(response){ReactGA.event({category:'Migrate',action:'V1->V2',label:token===null||token===void 0?void 0:token.symbol});addTransaction(response,{summary:\"Migrate \".concat(token.symbol,\" liquidity to V2\")});setPendingMigrationHash(response.hash);}).catch(function(){setConfirmingMigration(false);});},[minAmountToken,minAmountETH,migrator,token,account,addTransaction]);var noLiquidityTokens=!!liquidityTokenAmount&&liquidityTokenAmount.equalTo(ZERO);var largePriceDifference=!!priceDifferenceAbs&&!priceDifferenceAbs.lessThan(JSBI.BigInt(5));var isSuccessfullyMigrated=!!pendingMigrationHash&&!!noLiquidityTokens;return/*#__PURE__*/React.createElement(AutoColumn,{gap:\"20px\"},/*#__PURE__*/React.createElement(TYPE.body,{my:9,style:{fontWeight:400}},\"This tool will safely migrate your V1 liquidity to V2 with minimal price risk. The process is completely trustless thanks to the\",' ',/*#__PURE__*/React.createElement(ExternalLink,{href:getEtherscanLink(chainId,MIGRATOR_ADDRESS,'address')},/*#__PURE__*/React.createElement(TYPE.blue,{display:\"inline\"},\"Uniswap migration contract\\u2197\")),\".\"),!isFirstLiquidityProvider&&largePriceDifference?/*#__PURE__*/React.createElement(YellowCard,null,/*#__PURE__*/React.createElement(TYPE.body,{style:{marginBottom:8,fontWeight:400}},\"It\",\"'\",\"s best to deposit liquidity into Uniswap V2 at a price you believe is correct. If the V2 price seems incorrect, you can either make a swap to move the price or wait for someone else to do so.\"),/*#__PURE__*/React.createElement(AutoColumn,{gap:\"8px\"},/*#__PURE__*/React.createElement(RowBetween,null,/*#__PURE__*/React.createElement(TYPE.body,null,\"V1 Price:\"),/*#__PURE__*/React.createElement(TYPE.black,null,v1SpotPrice===null||v1SpotPrice===void 0?void 0:v1SpotPrice.toSignificant(6),\" \",token.symbol,\"/BNB\")),/*#__PURE__*/React.createElement(RowBetween,null,/*#__PURE__*/React.createElement(\"div\",null),/*#__PURE__*/React.createElement(TYPE.black,null,v1SpotPrice===null||v1SpotPrice===void 0?void 0:(_v1SpotPrice$invert=v1SpotPrice.invert())===null||_v1SpotPrice$invert===void 0?void 0:_v1SpotPrice$invert.toSignificant(6),\" BNB/\",token.symbol)),/*#__PURE__*/React.createElement(RowBetween,null,/*#__PURE__*/React.createElement(TYPE.body,null,\"V2 Price:\"),/*#__PURE__*/React.createElement(TYPE.black,null,v2SpotPrice===null||v2SpotPrice===void 0?void 0:v2SpotPrice.toSignificant(6),\" \",token.symbol,\"/BNB\")),/*#__PURE__*/React.createElement(RowBetween,null,/*#__PURE__*/React.createElement(\"div\",null),/*#__PURE__*/React.createElement(TYPE.black,null,v2SpotPrice===null||v2SpotPrice===void 0?void 0:(_v2SpotPrice$invert=v2SpotPrice.invert())===null||_v2SpotPrice$invert===void 0?void 0:_v2SpotPrice$invert.toSignificant(6),\" BNB/\",token.symbol)),/*#__PURE__*/React.createElement(RowBetween,null,/*#__PURE__*/React.createElement(TYPE.body,{color:\"inherit\"},\"Price Difference:\"),/*#__PURE__*/React.createElement(TYPE.black,{color:\"inherit\"},priceDifferenceAbs.toSignificant(4),\"%\")))):null,isFirstLiquidityProvider&&/*#__PURE__*/React.createElement(PinkCard,null,/*#__PURE__*/React.createElement(TYPE.body,{style:{marginBottom:8,fontWeight:400}},\"You are the first liquidity provider for this pair on Uniswap V2. Your liquidity will be migrated at the current V1 price. Your transaction cost also includes the gas to create the pool.\"),/*#__PURE__*/React.createElement(AutoColumn,{gap:\"8px\"},/*#__PURE__*/React.createElement(RowBetween,null,/*#__PURE__*/React.createElement(TYPE.body,null,\"V1 Price:\"),/*#__PURE__*/React.createElement(TYPE.black,null,v1SpotPrice===null||v1SpotPrice===void 0?void 0:v1SpotPrice.toSignificant(6),\" \",token.symbol,\"/BNB\")),/*#__PURE__*/React.createElement(RowBetween,null,/*#__PURE__*/React.createElement(\"div\",null),/*#__PURE__*/React.createElement(TYPE.black,null,v1SpotPrice===null||v1SpotPrice===void 0?void 0:(_v1SpotPrice$invert2=v1SpotPrice.invert())===null||_v1SpotPrice$invert2===void 0?void 0:_v1SpotPrice$invert2.toSignificant(6),\" BNB/\",token.symbol)))),/*#__PURE__*/React.createElement(LightCard,null,/*#__PURE__*/React.createElement(V1LiquidityInfo,{token:token,liquidityTokenAmount:liquidityTokenAmount,tokenWorth:tokenWorth,ethWorth:ethWorth}),/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',marginTop:'1rem'}},/*#__PURE__*/React.createElement(AutoColumn,{gap:\"12px\",style:{flex:'1',marginRight:12}},/*#__PURE__*/React.createElement(ButtonConfirmed,{confirmed:approval===ApprovalState.APPROVED,disabled:approval!==ApprovalState.NOT_APPROVED,onClick:approve},approval===ApprovalState.PENDING?/*#__PURE__*/React.createElement(Dots,null,\"Approving\"):approval===ApprovalState.APPROVED?'Approved':'Approve')),/*#__PURE__*/React.createElement(AutoColumn,{gap:\"12px\",style:{flex:'1'}},/*#__PURE__*/React.createElement(ButtonConfirmed,{confirmed:isSuccessfullyMigrated,disabled:isSuccessfullyMigrated||noLiquidityTokens||isMigrationPending||approval!==ApprovalState.APPROVED||confirmingMigration,onClick:migrate},isSuccessfullyMigrated?'Success':isMigrationPending?/*#__PURE__*/React.createElement(Dots,null,\"Migrating\"):'Migrate')))),/*#__PURE__*/React.createElement(TYPE.darkGray,{style:{textAlign:'center'}},\"Your Uniswap V1 \".concat(token.symbol,\"/BNB liquidity will become Uniswap V2 \").concat(token.symbol,\"/BNB liquidity.\")));}export default function MigrateV1Exchange(_ref4){var _useSingleCallResult,_useSingleCallResult$;var history=_ref4.history,address=_ref4.match.params.address;var validatedAddress=isAddress(address);var _useActiveWeb3React3=useActiveWeb3React(),chainId=_useActiveWeb3React3.chainId,account=_useActiveWeb3React3.account;var exchangeContract=useV1ExchangeContract(validatedAddress?validatedAddress:undefined);var tokenAddress=(_useSingleCallResult=useSingleCallResult(exchangeContract,'tokenAddress',undefined,NEVER_RELOAD))===null||_useSingleCallResult===void 0?void 0:(_useSingleCallResult$=_useSingleCallResult.result)===null||_useSingleCallResult$===void 0?void 0:_useSingleCallResult$[0];var token=useToken(tokenAddress);var liquidityToken=useMemo(function(){return validatedAddress&&token?new Token(chainId,validatedAddress,18,\"UNI-V1-\".concat(token.symbol),'Uniswap V1'):undefined;},[chainId,validatedAddress,token]);var userLiquidityBalance=useTokenBalance(account,liquidityToken);// redirect for invalid url params\nif(!validatedAddress||tokenAddress===AddressZero){console.error('Invalid address in path',address);return/*#__PURE__*/React.createElement(Redirect,{to:\"/migrate/v1\"});}return/*#__PURE__*/React.createElement(BodyWrapper,{style:{padding:24}},/*#__PURE__*/React.createElement(AutoColumn,{gap:\"16px\"},/*#__PURE__*/React.createElement(AutoRow,{style:{alignItems:'center',justifyContent:'space-between'},gap:\"8px\"},/*#__PURE__*/React.createElement(BackArrow,{to:\"/migrate/v1\"}),/*#__PURE__*/React.createElement(TYPE.mediumHeader,null,\"Migrate V1 Liquidity\"),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(QuestionHelper,{text:\"Migrate your liquidity tokens from Uniswap V1 to Uniswap V2.\"}))),!account?/*#__PURE__*/React.createElement(TYPE.largeHeader,null,\"You must connect an account.\"):validatedAddress&&(token===null||token===void 0?void 0:token.equals(WETH[chainId]))?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(TYPE.body,{my:9,style:{fontWeight:400}},\"Because Uniswap V2 uses WETH under the hood, your Uniswap V1 WETH/ETH liquidity cannot be migrated. You may want to remove your liquidity instead.\"),/*#__PURE__*/React.createElement(ButtonConfirmed,{onClick:function onClick(){history.push(\"/remove/v1/\".concat(validatedAddress));}},\"Remove\")):userLiquidityBalance&&token?/*#__PURE__*/React.createElement(V1PairMigration,{liquidityTokenAmount:userLiquidityBalance,token:token}):/*#__PURE__*/React.createElement(EmptyState,{message:\"Loading...\"})));}","map":{"version":3,"sources":["/Users/lap14205/Documents/home/blockchain_learning/bscswap-interface/src/pages/MigrateV1/MigrateV1Exchange.tsx"],"names":["AddressZero","Currency","CurrencyAmount","Fraction","JSBI","Percent","Token","TokenAmount","WETH","React","useCallback","useMemo","useState","ReactGA","Redirect","Text","ButtonConfirmed","LightCard","PinkCard","YellowCard","AutoColumn","CurrencyLogo","QuestionHelper","AutoRow","RowBetween","RowFixed","Dots","DEFAULT_DEADLINE_FROM_NOW","INITIAL_ALLOWED_SLIPPAGE","MIGRATOR_ADDRESS","PairState","usePair","useTotalSupply","useActiveWeb3React","useToken","ApprovalState","useApproveCallback","useV1ExchangeContract","useV2MigratorContract","NEVER_RELOAD","useSingleCallResult","useIsTransactionPending","useTransactionAdder","useETHBalances","useTokenBalance","BackArrow","ExternalLink","TYPE","getEtherscanLink","isAddress","BodyWrapper","EmptyState","POOL_CURRENCY_AMOUNT_MIN","BigInt","WEI_DENOM","exponentiate","ZERO","ONE","ZERO_FRACTION","ALLOWED_OUTPUT_MIN_PERCENT","FormattedPoolCurrencyAmount","currencyAmount","equalTo","greaterThan","toSignificant","V1LiquidityInfo","token","liquidityTokenAmount","tokenWorth","ethWorth","chainId","justifyContent","width","marginLeft","equals","symbol","ETHER","V1PairMigration","account","totalSupply","exchangeETHBalance","address","exchangeTokenBalance","undefined","v2PairState","v2Pair","isFirstLiquidityProvider","NOT_EXISTS","v2SpotPrice","reserveOf","divide","confirmingMigration","setConfirmingMigration","pendingMigrationHash","setPendingMigrationHash","shareFraction","raw","ether","multiply","quotient","approval","approve","v1SpotPrice","priceDifferenceFraction","subtract","priceDifferenceAbs","lessThan","minAmountETH","numerator","minAmountToken","decimals","addTransaction","isMigrationPending","migrator","migrate","toString","Math","floor","Date","getTime","then","response","event","category","action","label","summary","hash","catch","noLiquidityTokens","largePriceDifference","isSuccessfullyMigrated","fontWeight","marginBottom","invert","display","marginTop","flex","marginRight","APPROVED","NOT_APPROVED","PENDING","textAlign","MigrateV1Exchange","history","match","params","validatedAddress","exchangeContract","tokenAddress","result","liquidityToken","userLiquidityBalance","console","error","padding","alignItems","push"],"mappings":"2LACA,OAASA,WAAT,KAA4B,0BAA5B,CACA,OAASC,QAAT,CAAmBC,cAAnB,CAAmCC,QAAnC,CAA6CC,IAA7C,CAAmDC,OAAnD,CAA4DC,KAA5D,CAAmEC,WAAnE,CAAgFC,IAAhF,KAA4F,cAA5F,CACA,MAAOC,CAAAA,KAAP,EAAgBC,WAAhB,CAA6BC,OAA7B,CAAsCC,QAAtC,KAAsD,OAAtD,CACA,MAAOC,CAAAA,OAAP,KAAoB,UAApB,CACA,OAASC,QAAT,KAA8C,cAA9C,CACA,OAASC,IAAT,KAAqB,QAArB,CACA,OAASC,eAAT,KAAgC,yBAAhC,CACA,OAASC,SAAT,CAAoBC,QAApB,CAA8BC,UAA9B,KAAgD,uBAAhD,CACA,OAASC,UAAT,KAA2B,yBAA3B,CACA,MAAOC,CAAAA,YAAP,KAAyB,+BAAzB,CACA,MAAOC,CAAAA,cAAP,KAA2B,iCAA3B,CACA,OAASC,OAAT,CAAkBC,UAAlB,CAA8BC,QAA9B,KAA8C,sBAA9C,CACA,OAASC,IAAT,KAAqB,+BAArB,CACA,OAASC,yBAAT,CAAoCC,wBAApC,KAAoE,iBAApE,CACA,OAASC,gBAAT,KAAiC,+BAAjC,CACA,OAASC,SAAT,CAAoBC,OAApB,KAAmC,qBAAnC,CACA,OAASC,cAAT,KAA+B,wBAA/B,CACA,OAASC,kBAAT,KAAmC,aAAnC,CACA,OAASC,QAAT,KAAyB,oBAAzB,CACA,OAASC,aAAT,CAAwBC,kBAAxB,KAAkD,gCAAlD,CACA,OAASC,qBAAT,CAAgCC,qBAAhC,KAA6D,yBAA7D,CACA,OAASC,YAAT,CAAuBC,mBAAvB,KAAkD,6BAAlD,CACA,OAASC,uBAAT,CAAkCC,mBAAlC,KAA6D,gCAA7D,CACA,OAASC,cAAT,CAAyBC,eAAzB,KAAgD,0BAAhD,CACA,OAASC,SAAT,CAAoBC,YAApB,CAAkCC,IAAlC,KAA8C,aAA9C,CACA,OAASC,gBAAT,CAA2BC,SAA3B,KAA4C,aAA5C,CACA,OAASC,WAAT,KAA4B,YAA5B,CACA,OAASC,UAAT,KAA2B,cAA3B,CAEA,GAAMC,CAAAA,wBAAwB,CAAG,GAAIjD,CAAAA,QAAJ,CAAaC,IAAI,CAACiD,MAAL,CAAY,CAAZ,CAAb,CAA6BjD,IAAI,CAACiD,MAAL,CAAY,OAAZ,CAA7B,CAAjC,CACA,GAAMC,CAAAA,SAAS,CAAGlD,IAAI,CAACmD,YAAL,CAAkBnD,IAAI,CAACiD,MAAL,CAAY,EAAZ,CAAlB,CAAmCjD,IAAI,CAACiD,MAAL,CAAY,EAAZ,CAAnC,CAAlB,CACA,GAAMG,CAAAA,IAAI,CAAGpD,IAAI,CAACiD,MAAL,CAAY,CAAZ,CAAb,CACA,GAAMI,CAAAA,GAAG,CAAGrD,IAAI,CAACiD,MAAL,CAAY,CAAZ,CAAZ,CACA,GAAMK,CAAAA,aAAa,CAAG,GAAIvD,CAAAA,QAAJ,CAAaqD,IAAb,CAAmBC,GAAnB,CAAtB,CACA,GAAME,CAAAA,0BAA0B,CAAG,GAAItD,CAAAA,OAAJ,CAAYD,IAAI,CAACiD,MAAL,CAAY,MAAQzB,wBAApB,CAAZ,CAA2DxB,IAAI,CAACiD,MAAL,CAAY,KAAZ,CAA3D,CAAnC,CAEA,QAASO,CAAAA,2BAAT,MAA6F,IAAtDC,CAAAA,cAAsD,MAAtDA,cAAsD,CAC3F,mBACE,wCACGA,cAAc,CAACC,OAAf,CAAuB1D,IAAI,CAACiD,MAAL,CAAY,CAAZ,CAAvB,EACG,GADH,CAEGQ,cAAc,CAACE,WAAf,CAA2BX,wBAA3B,EACAS,cAAc,CAACG,aAAf,CAA6B,CAA7B,CADA,YAEIZ,wBAAwB,CAACY,aAAzB,CAAuC,CAAvC,CAFJ,CAHN,CADF,CASD,CAED,MAAO,SAASC,CAAAA,eAAT,OAUJ,IATDC,CAAAA,KASC,OATDA,KASC,CARDC,oBAQC,OARDA,oBAQC,CAPDC,UAOC,OAPDA,UAOC,CANDC,QAMC,OANDA,QAMC,yBACmBpC,kBAAkB,EADrC,CACOqC,OADP,qBACOA,OADP,CAGD,mBACE,qDACE,oBAAC,OAAD,EAAS,KAAK,CAAE,CAAEC,cAAc,CAAE,YAAlB,CAAgCC,KAAK,CAAE,aAAvC,CAAhB,eACE,oBAAC,YAAD,EAAc,IAAI,CAAC,MAAnB,CAA0B,QAAQ,CAAEN,KAApC,EADF,cAEE,2BAAK,KAAK,CAAE,CAAEO,UAAU,CAAE,QAAd,CAAZ,eACE,oBAAC,IAAD,CAAM,YAAN,mBACG,oBAAC,2BAAD,EAA6B,cAAc,CAAEN,oBAA7C,EADH,CAC0E,GAD1E,CAEGD,KAAK,CAACQ,MAAN,CAAalE,IAAI,CAAC8D,OAAD,CAAjB,EAA8B,MAA9B,CAAuCJ,KAAK,CAACS,MAFhD,QADF,CAFF,CADF,cAWE,oBAAC,UAAD,EAAY,EAAE,CAAC,MAAf,eACE,oBAAC,IAAD,EAAM,QAAQ,CAAE,EAAhB,CAAoB,UAAU,CAAE,GAAhC,YACUT,KAAK,CAACQ,MAAN,CAAalE,IAAI,CAAC8D,OAAD,CAAjB,EAA8B,MAA9B,CAAuCJ,KAAK,CAACS,MADvD,KADF,cAIE,oBAAC,QAAD,mBACE,oBAAC,IAAD,EAAM,QAAQ,CAAE,EAAhB,CAAoB,UAAU,CAAE,GAAhC,CAAqC,UAAU,CAAE,KAAjD,EACGP,UAAU,CAACJ,aAAX,CAAyB,CAAzB,CADH,CADF,cAIE,oBAAC,YAAD,EAAc,IAAI,CAAC,MAAnB,CAA0B,KAAK,CAAE,CAAES,UAAU,CAAE,KAAd,CAAjC,CAAwD,QAAQ,CAAEP,KAAlE,EAJF,CAJF,CAXF,cAsBE,oBAAC,UAAD,EAAY,EAAE,CAAC,MAAf,eACE,oBAAC,IAAD,EAAM,QAAQ,CAAE,EAAhB,CAAoB,UAAU,CAAE,GAAhC,gBADF,cAIE,oBAAC,QAAD,mBACE,oBAAC,IAAD,EAAM,QAAQ,CAAE,EAAhB,CAAoB,UAAU,CAAE,GAAhC,CAAqC,UAAU,CAAE,KAAjD,eACE,oBAAC,2BAAD,EAA6B,cAAc,CAAEG,QAA7C,EADF,CADF,cAIE,oBAAC,YAAD,EAAc,IAAI,CAAC,MAAnB,CAA0B,KAAK,CAAE,CAAEI,UAAU,CAAE,KAAd,CAAjC,CAAwD,QAAQ,CAAExE,QAAQ,CAAC2E,KAA3E,EAJF,CAJF,CAtBF,CADF,CAoCD,CAED,QAASC,CAAAA,eAAT,OAA+G,uGAApFV,CAAAA,oBAAoF,OAApFA,oBAAoF,CAA9DD,KAA8D,OAA9DA,KAA8D,0BAChFjC,kBAAkB,EAD8D,CACrG6C,OADqG,sBACrGA,OADqG,CAC5FR,OAD4F,sBAC5FA,OAD4F,CAE7G,GAAMS,CAAAA,WAAW,CAAG/C,cAAc,CAACmC,oBAAoB,CAACD,KAAtB,CAAlC,CACA,GAAMc,CAAAA,kBAAkB,kBAAGrC,cAAc,CAAC,CAACwB,oBAAoB,CAACD,KAArB,CAA2Be,OAA5B,CAAD,CAAjB,0CAAG,gBAAuDd,oBAAoB,CAACD,KAArB,CAA2Be,OAAlF,CAA3B,CACA,GAAMC,CAAAA,oBAAoB,CAAGtC,eAAe,CAACuB,oBAAoB,CAACD,KAArB,CAA2Be,OAA5B,CAAqCf,KAArC,CAA5C,CAJ6G,aAM/EnC,OAAO,CAACuC,OAAO,CAAG9D,IAAI,CAAC8D,OAAD,CAAP,CAAmBa,SAA3B,CAAsCjB,KAAtC,CANwE,sCAMtGkB,WANsG,cAMzFC,MANyF,cAO7G,GAAMC,CAAAA,wBAAiC,CAAGF,WAAW,GAAKtD,SAAS,CAACyD,UAApE,CAEA,GAAMC,CAAAA,WAAW,CAAGH,MAAH,SAAGA,MAAH,oCAAGA,MAAM,CAAEI,SAAR,CAAkBvB,KAAlB,CAAH,4CAAG,kBAA0BwB,MAA1B,CAAiCL,MAAjC,SAAiCA,MAAjC,iBAAiCA,MAAM,CAAEI,SAAR,CAAkBjF,IAAI,CAAC8D,OAAD,CAAtB,CAAjC,CAApB,CAT6G,cAWvD1D,QAAQ,CAAU,KAAV,CAX+C,wCAWtG+E,mBAXsG,eAWjFC,sBAXiF,8BAYrDhF,QAAQ,CAAgB,IAAhB,CAZ6C,yCAYtGiF,oBAZsG,eAYhFC,uBAZgF,eAc7G,GAAMC,CAAAA,aAAuB,CAAGhB,WAAW,CAAG,GAAI1E,CAAAA,OAAJ,CAAY8D,oBAAoB,CAAC6B,GAAjC,CAAsCjB,WAAW,CAACiB,GAAlD,CAAH,CAA4DtC,aAAvG,CAEA,GAAMW,CAAAA,QAAwB,CAAGW,kBAAkB,CAC/C9E,cAAc,CAAC+F,KAAf,CAAqBjB,kBAAkB,CAACkB,QAAnB,CAA4BH,aAA5B,EAA2CG,QAA3C,CAAoD5C,SAApD,EAA+D6C,QAApF,CAD+C,CAE/CjG,cAAc,CAAC+F,KAAf,CAAqBzC,IAArB,CAFJ,CAIA,GAAMY,CAAAA,UAAuB,CAAGc,oBAAoB,CAChD,GAAI3E,CAAAA,WAAJ,CAAgB2D,KAAhB,CAAuB6B,aAAa,CAACG,QAAd,CAAuBhB,oBAAoB,CAACc,GAA5C,EAAiDG,QAAxE,CADgD,CAEhD,GAAI5F,CAAAA,WAAJ,CAAgB2D,KAAhB,CAAuBV,IAAvB,CAFJ,CApB6G,wBAwBjFpB,kBAAkB,CAAC+B,oBAAD,CAAuBtC,gBAAvB,CAxB+D,4DAwBtGuE,QAxBsG,yBAwB5FC,OAxB4F,yBA0B7G,GAAMC,CAAAA,WAAW,CACfpB,oBAAoB,EAAIF,kBAAxB,CACIE,oBAAoB,CAACQ,MAArB,CAA4B,GAAIvF,CAAAA,QAAJ,CAAa6E,kBAAkB,CAACgB,GAAhC,CAAqC1C,SAArC,CAA5B,CADJ,CAEI,IAHN,CAKA,GAAMiD,CAAAA,uBAA6C,CACjDD,WAAW,EAAId,WAAf,CACIc,WAAW,CACRZ,MADH,CACUF,WADV,EAEGU,QAFH,CAEY,KAFZ,EAGGM,QAHH,CAGY,KAHZ,CADJ,CAKIrB,SANN,CAQA,GAAMsB,CAAAA,kBAAwC,CAAG,CAAAF,uBAAuB,OAAvB,EAAAA,uBAAuB,SAAvB,QAAAA,uBAAuB,CAAEG,QAAzB,CAAkClD,IAAlC,GAC7C+C,uBAD6C,SAC7CA,uBAD6C,iBAC7CA,uBAAuB,CAAEL,QAAzB,CAAkC,IAAlC,CAD6C,CAE7CK,uBAFJ,CAIA,GAAMI,CAAAA,YAA8B,CAClCnB,WAAW,EAAIpB,UAAf,CACIA,UAAU,CACPsB,MADH,CACUF,WADV,EAEGU,QAFH,CAEY5C,SAFZ,EAGG4C,QAHH,CAGYvC,0BAHZ,EAGwCwC,QAJ5C,CAKI9B,QALJ,SAKIA,QALJ,iBAKIA,QAAQ,CAAEuC,SANhB,CAQA,GAAMC,CAAAA,cAAgC,CACpCrB,WAAW,EAAInB,QAAf,CACIA,QAAQ,CACL6B,QADH,CACYV,WADZ,EAEGU,QAFH,CAEY9F,IAAI,CAACmD,YAAL,CAAkBnD,IAAI,CAACiD,MAAL,CAAY,EAAZ,CAAlB,CAAmCjD,IAAI,CAACiD,MAAL,CAAYa,KAAK,CAAC4C,QAAlB,CAAnC,CAFZ,EAGGZ,QAHH,CAGYvC,0BAHZ,EAGwCwC,QAJ5C,CAKI/B,UALJ,SAKIA,UALJ,iBAKIA,UAAU,CAAEwC,SANlB,CAQA,GAAMG,CAAAA,cAAc,CAAGrE,mBAAmB,EAA1C,CACA,GAAMsE,CAAAA,kBAAkB,CAAGvE,uBAAuB,CAACoD,oBAAD,CAAlD,CAEA,GAAMoB,CAAAA,QAAQ,CAAG3E,qBAAqB,EAAtC,CACA,GAAM4E,CAAAA,OAAO,CAAGxG,WAAW,CAAC,UAAM,CAChC,GAAI,CAACmG,cAAD,EAAmB,CAACF,YAAxB,CAAsC,OAEtCf,sBAAsB,CAAC,IAAD,CAAtB,CACAqB,QAAQ,CACLC,OADH,CAEIhD,KAAK,CAACe,OAFV,CAGI4B,cAAc,CAACM,QAAf,EAHJ,CAIIR,YAAY,CAACQ,QAAb,EAJJ,CAKIrC,OALJ,CAMIsC,IAAI,CAACC,KAAL,CAAW,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,GAAuB,IAAlC,EAA0C5F,yBAN9C,EAQG6F,IARH,CAQQ,SAACC,QAAD,CAAmC,CACvC5G,OAAO,CAAC6G,KAAR,CAAc,CACZC,QAAQ,CAAE,SADE,CAEZC,MAAM,CAAE,QAFI,CAGZC,KAAK,CAAE3D,KAAF,SAAEA,KAAF,iBAAEA,KAAK,CAAES,MAHF,CAAd,EAMAoC,cAAc,CAACU,QAAD,CAAW,CACvBK,OAAO,mBAAa5D,KAAK,CAACS,MAAnB,oBADgB,CAAX,CAAd,CAGAmB,uBAAuB,CAAC2B,QAAQ,CAACM,IAAV,CAAvB,CACD,CAnBH,EAoBGC,KApBH,CAoBS,UAAM,CACXpC,sBAAsB,CAAC,KAAD,CAAtB,CACD,CAtBH,EAuBD,CA3B0B,CA2BxB,CAACiB,cAAD,CAAiBF,YAAjB,CAA+BM,QAA/B,CAAyC/C,KAAzC,CAAgDY,OAAhD,CAAyDiC,cAAzD,CA3BwB,CAA3B,CA6BA,GAAMkB,CAAAA,iBAAiB,CAAG,CAAC,CAAC9D,oBAAF,EAA0BA,oBAAoB,CAACL,OAArB,CAA6BN,IAA7B,CAApD,CAEA,GAAM0E,CAAAA,oBAAoB,CAAG,CAAC,CAACzB,kBAAF,EAAwB,CAACA,kBAAkB,CAACC,QAAnB,CAA4BtG,IAAI,CAACiD,MAAL,CAAY,CAAZ,CAA5B,CAAtD,CAEA,GAAM8E,CAAAA,sBAAsB,CAAG,CAAC,CAACtC,oBAAF,EAA0B,CAAC,CAACoC,iBAA3D,CAEA,mBACE,oBAAC,UAAD,EAAY,GAAG,CAAC,MAAhB,eACE,oBAAC,IAAD,CAAM,IAAN,EAAW,EAAE,CAAE,CAAf,CAAkB,KAAK,CAAE,CAAEG,UAAU,CAAE,GAAd,CAAzB,qIAE0B,GAF1B,cAGE,oBAAC,YAAD,EAAc,IAAI,CAAEpF,gBAAgB,CAACsB,OAAD,CAAUzC,gBAAV,CAA4B,SAA5B,CAApC,eACE,oBAAC,IAAD,CAAM,IAAN,EAAW,OAAO,CAAC,QAAnB,qCADF,CAHF,KADF,CAUG,CAACyD,wBAAD,EAA6B4C,oBAA7B,cACC,oBAAC,UAAD,mBACE,oBAAC,IAAD,CAAM,IAAN,EAAW,KAAK,CAAE,CAAEG,YAAY,CAAE,CAAhB,CAAmBD,UAAU,CAAE,GAA/B,CAAlB,OACK,GADL,mMADF,cAKE,oBAAC,UAAD,EAAY,GAAG,CAAC,KAAhB,eACE,oBAAC,UAAD,mBACE,oBAAC,IAAD,CAAM,IAAN,kBADF,cAEE,oBAAC,IAAD,CAAM,KAAN,MACG9B,WADH,SACGA,WADH,iBACGA,WAAW,CAAEtC,aAAb,CAA2B,CAA3B,CADH,KACmCE,KAAK,CAACS,MADzC,QAFF,CADF,cAOE,oBAAC,UAAD,mBACE,+BADF,cAEE,oBAAC,IAAD,CAAM,KAAN,MACG2B,WADH,SACGA,WADH,sCACGA,WAAW,CAAEgC,MAAb,EADH,8CACG,oBAAuBtE,aAAvB,CAAqC,CAArC,CADH,SACiDE,KAAK,CAACS,MADvD,CAFF,CAPF,cAcE,oBAAC,UAAD,mBACE,oBAAC,IAAD,CAAM,IAAN,kBADF,cAEE,oBAAC,IAAD,CAAM,KAAN,MACGa,WADH,SACGA,WADH,iBACGA,WAAW,CAAExB,aAAb,CAA2B,CAA3B,CADH,KACmCE,KAAK,CAACS,MADzC,QAFF,CAdF,cAoBE,oBAAC,UAAD,mBACE,+BADF,cAEE,oBAAC,IAAD,CAAM,KAAN,MACGa,WADH,SACGA,WADH,sCACGA,WAAW,CAAE8C,MAAb,EADH,8CACG,oBAAuBtE,aAAvB,CAAqC,CAArC,CADH,SACiDE,KAAK,CAACS,MADvD,CAFF,CApBF,cA2BE,oBAAC,UAAD,mBACE,oBAAC,IAAD,CAAM,IAAN,EAAW,KAAK,CAAC,SAAjB,sBADF,cAEE,oBAAC,IAAD,CAAM,KAAN,EAAY,KAAK,CAAC,SAAlB,EAA6B8B,kBAAkB,CAACzC,aAAnB,CAAiC,CAAjC,CAA7B,KAFF,CA3BF,CALF,CADD,CAuCG,IAjDN,CAmDGsB,wBAAwB,eACvB,oBAAC,QAAD,mBACE,oBAAC,IAAD,CAAM,IAAN,EAAW,KAAK,CAAE,CAAE+C,YAAY,CAAE,CAAhB,CAAmBD,UAAU,CAAE,GAA/B,CAAlB,+LADF,cAME,oBAAC,UAAD,EAAY,GAAG,CAAC,KAAhB,eACE,oBAAC,UAAD,mBACE,oBAAC,IAAD,CAAM,IAAN,kBADF,cAEE,oBAAC,IAAD,CAAM,KAAN,MACG9B,WADH,SACGA,WADH,iBACGA,WAAW,CAAEtC,aAAb,CAA2B,CAA3B,CADH,KACmCE,KAAK,CAACS,MADzC,QAFF,CADF,cAOE,oBAAC,UAAD,mBACE,+BADF,cAEE,oBAAC,IAAD,CAAM,KAAN,MACG2B,WADH,SACGA,WADH,uCACGA,WAAW,CAAEgC,MAAb,EADH,+CACG,qBAAuBtE,aAAvB,CAAqC,CAArC,CADH,SACiDE,KAAK,CAACS,MADvD,CAFF,CAPF,CANF,CApDJ,cA2EE,oBAAC,SAAD,mBACE,oBAAC,eAAD,EACE,KAAK,CAAET,KADT,CAEE,oBAAoB,CAAEC,oBAFxB,CAGE,UAAU,CAAEC,UAHd,CAIE,QAAQ,CAAEC,QAJZ,EADF,cAQE,2BAAK,KAAK,CAAE,CAAEkE,OAAO,CAAE,MAAX,CAAmBC,SAAS,CAAE,MAA9B,CAAZ,eACE,oBAAC,UAAD,EAAY,GAAG,CAAC,MAAhB,CAAuB,KAAK,CAAE,CAAEC,IAAI,CAAE,GAAR,CAAaC,WAAW,CAAE,EAA1B,CAA9B,eACE,oBAAC,eAAD,EACE,SAAS,CAAEtC,QAAQ,GAAKjE,aAAa,CAACwG,QADxC,CAEE,QAAQ,CAAEvC,QAAQ,GAAKjE,aAAa,CAACyG,YAFvC,CAGE,OAAO,CAAEvC,OAHX,EAKGD,QAAQ,GAAKjE,aAAa,CAAC0G,OAA3B,cACC,oBAAC,IAAD,kBADD,CAEGzC,QAAQ,GAAKjE,aAAa,CAACwG,QAA3B,CACF,UADE,CAGF,SAVJ,CADF,CADF,cAgBE,oBAAC,UAAD,EAAY,GAAG,CAAC,MAAhB,CAAuB,KAAK,CAAE,CAAEF,IAAI,CAAE,GAAR,CAA9B,eACE,oBAAC,eAAD,EACE,SAAS,CAAEN,sBADb,CAEE,QAAQ,CACNA,sBAAsB,EACtBF,iBADA,EAEAjB,kBAFA,EAGAZ,QAAQ,GAAKjE,aAAa,CAACwG,QAH3B,EAIAhD,mBAPJ,CASE,OAAO,CAAEuB,OATX,EAWGiB,sBAAsB,CAAG,SAAH,CAAenB,kBAAkB,cAAG,oBAAC,IAAD,kBAAH,CAA4B,SAXtF,CADF,CAhBF,CARF,CA3EF,cAoHE,oBAAC,IAAD,CAAM,QAAN,EAAe,KAAK,CAAE,CAAE8B,SAAS,CAAE,QAAb,CAAtB,4BACsB5E,KAAK,CAACS,MAD5B,kDAC2ET,KAAK,CAACS,MADjF,oBApHF,CADF,CA0HD,CAED,cAAe,SAASoE,CAAAA,iBAAT,OAK8B,mDAJ3CC,CAAAA,OAI2C,OAJ3CA,OAI2C,CAF/B/D,OAE+B,OAH3CgE,KAG2C,CAFzCC,MAEyC,CAF/BjE,OAE+B,CAC3C,GAAMkE,CAAAA,gBAAgB,CAAGlG,SAAS,CAACgC,OAAD,CAAlC,CAD2C,yBAEdhD,kBAAkB,EAFJ,CAEnCqC,OAFmC,sBAEnCA,OAFmC,CAE1BQ,OAF0B,sBAE1BA,OAF0B,CAI3C,GAAMsE,CAAAA,gBAAgB,CAAG/G,qBAAqB,CAAC8G,gBAAgB,CAAGA,gBAAH,CAAsBhE,SAAvC,CAA9C,CACA,GAAMkE,CAAAA,YAAY,uBAAG7G,mBAAmB,CAAC4G,gBAAD,CAAmB,cAAnB,CAAmCjE,SAAnC,CAA8C5C,YAA9C,CAAtB,sEAAG,qBAAgF+G,MAAnF,gDAAG,sBAAyF,CAAzF,CAArB,CAEA,GAAMpF,CAAAA,KAAK,CAAGhC,QAAQ,CAACmH,YAAD,CAAtB,CAEA,GAAME,CAAAA,cAAiC,CAAG5I,OAAO,CAC/C,iBACEwI,CAAAA,gBAAgB,EAAIjF,KAApB,CACI,GAAI5D,CAAAA,KAAJ,CAAUgE,OAAV,CAAmB6E,gBAAnB,CAAqC,EAArC,kBAAmDjF,KAAK,CAACS,MAAzD,EAAmE,YAAnE,CADJ,CAEIQ,SAHN,EAD+C,CAK/C,CAACb,OAAD,CAAU6E,gBAAV,CAA4BjF,KAA5B,CAL+C,CAAjD,CAOA,GAAMsF,CAAAA,oBAAoB,CAAG5G,eAAe,CAACkC,OAAD,CAAUyE,cAAV,CAA5C,CAEA;AACA,GAAI,CAACJ,gBAAD,EAAqBE,YAAY,GAAKrJ,WAA1C,CAAuD,CACrDyJ,OAAO,CAACC,KAAR,CAAc,yBAAd,CAAyCzE,OAAzC,EACA,mBAAO,oBAAC,QAAD,EAAU,EAAE,CAAC,aAAb,EAAP,CACD,CAED,mBACE,oBAAC,WAAD,EAAa,KAAK,CAAE,CAAE0E,OAAO,CAAE,EAAX,CAApB,eACE,oBAAC,UAAD,EAAY,GAAG,CAAC,MAAhB,eACE,oBAAC,OAAD,EAAS,KAAK,CAAE,CAAEC,UAAU,CAAE,QAAd,CAAwBrF,cAAc,CAAE,eAAxC,CAAhB,CAA2E,GAAG,CAAC,KAA/E,eACE,oBAAC,SAAD,EAAW,EAAE,CAAC,aAAd,EADF,cAEE,oBAAC,IAAD,CAAM,YAAN,6BAFF,cAGE,4CACE,oBAAC,cAAD,EAAgB,IAAI,CAAC,8DAArB,EADF,CAHF,CADF,CASG,CAACO,OAAD,cACC,oBAAC,IAAD,CAAM,WAAN,qCADD,CAEGqE,gBAAgB,GAAIjF,KAAJ,SAAIA,KAAJ,iBAAIA,KAAK,CAAEQ,MAAP,CAAclE,IAAI,CAAC8D,OAAD,CAAlB,CAAJ,CAAhB,cACF,qDACE,oBAAC,IAAD,CAAM,IAAN,EAAW,EAAE,CAAE,CAAf,CAAkB,KAAK,CAAE,CAAE8D,UAAU,CAAE,GAAd,CAAzB,uJADF,cAME,oBAAC,eAAD,EACE,OAAO,CAAE,kBAAM,CACbY,OAAO,CAACa,IAAR,sBAA2BV,gBAA3B,GACD,CAHH,WANF,CADE,CAeAK,oBAAoB,EAAItF,KAAxB,cACF,oBAAC,eAAD,EAAiB,oBAAoB,CAAEsF,oBAAvC,CAA6D,KAAK,CAAEtF,KAApE,EADE,cAGF,oBAAC,UAAD,EAAY,OAAO,CAAC,YAApB,EA7BJ,CADF,CADF,CAoCD","sourcesContent":["import { TransactionResponse } from '@ethersproject/abstract-provider'\nimport { AddressZero } from '@ethersproject/constants'\nimport { Currency, CurrencyAmount, Fraction, JSBI, Percent, Token, TokenAmount, WETH } from '@bscswap/sdk'\nimport React, { useCallback, useMemo, useState } from 'react'\nimport ReactGA from 'react-ga'\nimport { Redirect, RouteComponentProps } from 'react-router'\nimport { Text } from 'rebass'\nimport { ButtonConfirmed } from '../../components/Button'\nimport { LightCard, PinkCard, YellowCard } from '../../components/Card'\nimport { AutoColumn } from '../../components/Column'\nimport CurrencyLogo from '../../components/CurrencyLogo'\nimport QuestionHelper from '../../components/QuestionHelper'\nimport { AutoRow, RowBetween, RowFixed } from '../../components/Row'\nimport { Dots } from '../../components/swap/styleds'\nimport { DEFAULT_DEADLINE_FROM_NOW, INITIAL_ALLOWED_SLIPPAGE } from '../../constants'\nimport { MIGRATOR_ADDRESS } from '../../constants/abis/migrator'\nimport { PairState, usePair } from '../../data/Reserves'\nimport { useTotalSupply } from '../../data/TotalSupply'\nimport { useActiveWeb3React } from '../../hooks'\nimport { useToken } from '../../hooks/Tokens'\nimport { ApprovalState, useApproveCallback } from '../../hooks/useApproveCallback'\nimport { useV1ExchangeContract, useV2MigratorContract } from '../../hooks/useContract'\nimport { NEVER_RELOAD, useSingleCallResult } from '../../state/multicall/hooks'\nimport { useIsTransactionPending, useTransactionAdder } from '../../state/transactions/hooks'\nimport { useETHBalances, useTokenBalance } from '../../state/wallet/hooks'\nimport { BackArrow, ExternalLink, TYPE } from '../../theme'\nimport { getEtherscanLink, isAddress } from '../../utils'\nimport { BodyWrapper } from '../AppBody'\nimport { EmptyState } from './EmptyState'\n\nconst POOL_CURRENCY_AMOUNT_MIN = new Fraction(JSBI.BigInt(1), JSBI.BigInt(1000000))\nconst WEI_DENOM = JSBI.exponentiate(JSBI.BigInt(10), JSBI.BigInt(18))\nconst ZERO = JSBI.BigInt(0)\nconst ONE = JSBI.BigInt(1)\nconst ZERO_FRACTION = new Fraction(ZERO, ONE)\nconst ALLOWED_OUTPUT_MIN_PERCENT = new Percent(JSBI.BigInt(10000 - INITIAL_ALLOWED_SLIPPAGE), JSBI.BigInt(10000))\n\nfunction FormattedPoolCurrencyAmount({ currencyAmount }: { currencyAmount: CurrencyAmount }) {\n  return (\n    <>\n      {currencyAmount.equalTo(JSBI.BigInt(0))\n        ? '0'\n        : currencyAmount.greaterThan(POOL_CURRENCY_AMOUNT_MIN)\n        ? currencyAmount.toSignificant(4)\n        : `<${POOL_CURRENCY_AMOUNT_MIN.toSignificant(1)}`}\n    </>\n  )\n}\n\nexport function V1LiquidityInfo({\n  token,\n  liquidityTokenAmount,\n  tokenWorth,\n  ethWorth\n}: {\n  token: Token\n  liquidityTokenAmount: TokenAmount\n  tokenWorth: TokenAmount\n  ethWorth: CurrencyAmount\n}) {\n  const { chainId } = useActiveWeb3React()\n\n  return (\n    <>\n      <AutoRow style={{ justifyContent: 'flex-start', width: 'fit-content' }}>\n        <CurrencyLogo size=\"24px\" currency={token} />\n        <div style={{ marginLeft: '.75rem' }}>\n          <TYPE.mediumHeader>\n            {<FormattedPoolCurrencyAmount currencyAmount={liquidityTokenAmount} />}{' '}\n            {token.equals(WETH[chainId]) ? 'WETH' : token.symbol}/BNB\n          </TYPE.mediumHeader>\n        </div>\n      </AutoRow>\n\n      <RowBetween my=\"1rem\">\n        <Text fontSize={16} fontWeight={500}>\n          Pooled {token.equals(WETH[chainId]) ? 'WETH' : token.symbol}:\n        </Text>\n        <RowFixed>\n          <Text fontSize={16} fontWeight={500} marginLeft={'6px'}>\n            {tokenWorth.toSignificant(4)}\n          </Text>\n          <CurrencyLogo size=\"20px\" style={{ marginLeft: '8px' }} currency={token} />\n        </RowFixed>\n      </RowBetween>\n      <RowBetween mb=\"1rem\">\n        <Text fontSize={16} fontWeight={500}>\n          Pooled ETH:\n        </Text>\n        <RowFixed>\n          <Text fontSize={16} fontWeight={500} marginLeft={'6px'}>\n            <FormattedPoolCurrencyAmount currencyAmount={ethWorth} />\n          </Text>\n          <CurrencyLogo size=\"20px\" style={{ marginLeft: '8px' }} currency={Currency.ETHER} />\n        </RowFixed>\n      </RowBetween>\n    </>\n  )\n}\n\nfunction V1PairMigration({ liquidityTokenAmount, token }: { liquidityTokenAmount: TokenAmount; token: Token }) {\n  const { account, chainId } = useActiveWeb3React()\n  const totalSupply = useTotalSupply(liquidityTokenAmount.token)\n  const exchangeETHBalance = useETHBalances([liquidityTokenAmount.token.address])?.[liquidityTokenAmount.token.address]\n  const exchangeTokenBalance = useTokenBalance(liquidityTokenAmount.token.address, token)\n\n  const [v2PairState, v2Pair] = usePair(chainId ? WETH[chainId] : undefined, token)\n  const isFirstLiquidityProvider: boolean = v2PairState === PairState.NOT_EXISTS\n\n  const v2SpotPrice = v2Pair?.reserveOf(token)?.divide(v2Pair?.reserveOf(WETH[chainId]))\n\n  const [confirmingMigration, setConfirmingMigration] = useState<boolean>(false)\n  const [pendingMigrationHash, setPendingMigrationHash] = useState<string | null>(null)\n\n  const shareFraction: Fraction = totalSupply ? new Percent(liquidityTokenAmount.raw, totalSupply.raw) : ZERO_FRACTION\n\n  const ethWorth: CurrencyAmount = exchangeETHBalance\n    ? CurrencyAmount.ether(exchangeETHBalance.multiply(shareFraction).multiply(WEI_DENOM).quotient)\n    : CurrencyAmount.ether(ZERO)\n\n  const tokenWorth: TokenAmount = exchangeTokenBalance\n    ? new TokenAmount(token, shareFraction.multiply(exchangeTokenBalance.raw).quotient)\n    : new TokenAmount(token, ZERO)\n\n  const [approval, approve] = useApproveCallback(liquidityTokenAmount, MIGRATOR_ADDRESS)\n\n  const v1SpotPrice =\n    exchangeTokenBalance && exchangeETHBalance\n      ? exchangeTokenBalance.divide(new Fraction(exchangeETHBalance.raw, WEI_DENOM))\n      : null\n\n  const priceDifferenceFraction: Fraction | undefined =\n    v1SpotPrice && v2SpotPrice\n      ? v1SpotPrice\n          .divide(v2SpotPrice)\n          .multiply('100')\n          .subtract('100')\n      : undefined\n\n  const priceDifferenceAbs: Fraction | undefined = priceDifferenceFraction?.lessThan(ZERO)\n    ? priceDifferenceFraction?.multiply('-1')\n    : priceDifferenceFraction\n\n  const minAmountETH: JSBI | undefined =\n    v2SpotPrice && tokenWorth\n      ? tokenWorth\n          .divide(v2SpotPrice)\n          .multiply(WEI_DENOM)\n          .multiply(ALLOWED_OUTPUT_MIN_PERCENT).quotient\n      : ethWorth?.numerator\n\n  const minAmountToken: JSBI | undefined =\n    v2SpotPrice && ethWorth\n      ? ethWorth\n          .multiply(v2SpotPrice)\n          .multiply(JSBI.exponentiate(JSBI.BigInt(10), JSBI.BigInt(token.decimals)))\n          .multiply(ALLOWED_OUTPUT_MIN_PERCENT).quotient\n      : tokenWorth?.numerator\n\n  const addTransaction = useTransactionAdder()\n  const isMigrationPending = useIsTransactionPending(pendingMigrationHash)\n\n  const migrator = useV2MigratorContract()\n  const migrate = useCallback(() => {\n    if (!minAmountToken || !minAmountETH) return\n\n    setConfirmingMigration(true)\n    migrator\n      .migrate(\n        token.address,\n        minAmountToken.toString(),\n        minAmountETH.toString(),\n        account,\n        Math.floor(new Date().getTime() / 1000) + DEFAULT_DEADLINE_FROM_NOW\n      )\n      .then((response: TransactionResponse) => {\n        ReactGA.event({\n          category: 'Migrate',\n          action: 'V1->V2',\n          label: token?.symbol\n        })\n\n        addTransaction(response, {\n          summary: `Migrate ${token.symbol} liquidity to V2`\n        })\n        setPendingMigrationHash(response.hash)\n      })\n      .catch(() => {\n        setConfirmingMigration(false)\n      })\n  }, [minAmountToken, minAmountETH, migrator, token, account, addTransaction])\n\n  const noLiquidityTokens = !!liquidityTokenAmount && liquidityTokenAmount.equalTo(ZERO)\n\n  const largePriceDifference = !!priceDifferenceAbs && !priceDifferenceAbs.lessThan(JSBI.BigInt(5))\n\n  const isSuccessfullyMigrated = !!pendingMigrationHash && !!noLiquidityTokens\n\n  return (\n    <AutoColumn gap=\"20px\">\n      <TYPE.body my={9} style={{ fontWeight: 400 }}>\n        This tool will safely migrate your V1 liquidity to V2 with minimal price risk. The process is completely\n        trustless thanks to the{' '}\n        <ExternalLink href={getEtherscanLink(chainId, MIGRATOR_ADDRESS, 'address')}>\n          <TYPE.blue display=\"inline\">Uniswap migration contractâ†—</TYPE.blue>\n        </ExternalLink>\n        .\n      </TYPE.body>\n\n      {!isFirstLiquidityProvider && largePriceDifference ? (\n        <YellowCard>\n          <TYPE.body style={{ marginBottom: 8, fontWeight: 400 }}>\n            It{\"'\"}s best to deposit liquidity into Uniswap V2 at a price you believe is correct. If the V2 price seems\n            incorrect, you can either make a swap to move the price or wait for someone else to do so.\n          </TYPE.body>\n          <AutoColumn gap=\"8px\">\n            <RowBetween>\n              <TYPE.body>V1 Price:</TYPE.body>\n              <TYPE.black>\n                {v1SpotPrice?.toSignificant(6)} {token.symbol}/BNB\n              </TYPE.black>\n            </RowBetween>\n            <RowBetween>\n              <div />\n              <TYPE.black>\n                {v1SpotPrice?.invert()?.toSignificant(6)} BNB/{token.symbol}\n              </TYPE.black>\n            </RowBetween>\n\n            <RowBetween>\n              <TYPE.body>V2 Price:</TYPE.body>\n              <TYPE.black>\n                {v2SpotPrice?.toSignificant(6)} {token.symbol}/BNB\n              </TYPE.black>\n            </RowBetween>\n            <RowBetween>\n              <div />\n              <TYPE.black>\n                {v2SpotPrice?.invert()?.toSignificant(6)} BNB/{token.symbol}\n              </TYPE.black>\n            </RowBetween>\n\n            <RowBetween>\n              <TYPE.body color=\"inherit\">Price Difference:</TYPE.body>\n              <TYPE.black color=\"inherit\">{priceDifferenceAbs.toSignificant(4)}%</TYPE.black>\n            </RowBetween>\n          </AutoColumn>\n        </YellowCard>\n      ) : null}\n\n      {isFirstLiquidityProvider && (\n        <PinkCard>\n          <TYPE.body style={{ marginBottom: 8, fontWeight: 400 }}>\n            You are the first liquidity provider for this pair on Uniswap V2. Your liquidity will be migrated at the\n            current V1 price. Your transaction cost also includes the gas to create the pool.\n          </TYPE.body>\n\n          <AutoColumn gap=\"8px\">\n            <RowBetween>\n              <TYPE.body>V1 Price:</TYPE.body>\n              <TYPE.black>\n                {v1SpotPrice?.toSignificant(6)} {token.symbol}/BNB\n              </TYPE.black>\n            </RowBetween>\n            <RowBetween>\n              <div />\n              <TYPE.black>\n                {v1SpotPrice?.invert()?.toSignificant(6)} BNB/{token.symbol}\n              </TYPE.black>\n            </RowBetween>\n          </AutoColumn>\n        </PinkCard>\n      )}\n\n      <LightCard>\n        <V1LiquidityInfo\n          token={token}\n          liquidityTokenAmount={liquidityTokenAmount}\n          tokenWorth={tokenWorth}\n          ethWorth={ethWorth}\n        />\n\n        <div style={{ display: 'flex', marginTop: '1rem' }}>\n          <AutoColumn gap=\"12px\" style={{ flex: '1', marginRight: 12 }}>\n            <ButtonConfirmed\n              confirmed={approval === ApprovalState.APPROVED}\n              disabled={approval !== ApprovalState.NOT_APPROVED}\n              onClick={approve}\n            >\n              {approval === ApprovalState.PENDING ? (\n                <Dots>Approving</Dots>\n              ) : approval === ApprovalState.APPROVED ? (\n                'Approved'\n              ) : (\n                'Approve'\n              )}\n            </ButtonConfirmed>\n          </AutoColumn>\n          <AutoColumn gap=\"12px\" style={{ flex: '1' }}>\n            <ButtonConfirmed\n              confirmed={isSuccessfullyMigrated}\n              disabled={\n                isSuccessfullyMigrated ||\n                noLiquidityTokens ||\n                isMigrationPending ||\n                approval !== ApprovalState.APPROVED ||\n                confirmingMigration\n              }\n              onClick={migrate}\n            >\n              {isSuccessfullyMigrated ? 'Success' : isMigrationPending ? <Dots>Migrating</Dots> : 'Migrate'}\n            </ButtonConfirmed>\n          </AutoColumn>\n        </div>\n      </LightCard>\n      <TYPE.darkGray style={{ textAlign: 'center' }}>\n        {`Your Uniswap V1 ${token.symbol}/BNB liquidity will become Uniswap V2 ${token.symbol}/BNB liquidity.`}\n      </TYPE.darkGray>\n    </AutoColumn>\n  )\n}\n\nexport default function MigrateV1Exchange({\n  history,\n  match: {\n    params: { address }\n  }\n}: RouteComponentProps<{ address: string }>) {\n  const validatedAddress = isAddress(address)\n  const { chainId, account } = useActiveWeb3React()\n\n  const exchangeContract = useV1ExchangeContract(validatedAddress ? validatedAddress : undefined)\n  const tokenAddress = useSingleCallResult(exchangeContract, 'tokenAddress', undefined, NEVER_RELOAD)?.result?.[0]\n\n  const token = useToken(tokenAddress)\n\n  const liquidityToken: Token | undefined = useMemo(\n    () =>\n      validatedAddress && token\n        ? new Token(chainId, validatedAddress, 18, `UNI-V1-${token.symbol}`, 'Uniswap V1')\n        : undefined,\n    [chainId, validatedAddress, token]\n  )\n  const userLiquidityBalance = useTokenBalance(account, liquidityToken)\n\n  // redirect for invalid url params\n  if (!validatedAddress || tokenAddress === AddressZero) {\n    console.error('Invalid address in path', address)\n    return <Redirect to=\"/migrate/v1\" />\n  }\n\n  return (\n    <BodyWrapper style={{ padding: 24 }}>\n      <AutoColumn gap=\"16px\">\n        <AutoRow style={{ alignItems: 'center', justifyContent: 'space-between' }} gap=\"8px\">\n          <BackArrow to=\"/migrate/v1\" />\n          <TYPE.mediumHeader>Migrate V1 Liquidity</TYPE.mediumHeader>\n          <div>\n            <QuestionHelper text=\"Migrate your liquidity tokens from Uniswap V1 to Uniswap V2.\" />\n          </div>\n        </AutoRow>\n\n        {!account ? (\n          <TYPE.largeHeader>You must connect an account.</TYPE.largeHeader>\n        ) : validatedAddress && token?.equals(WETH[chainId]) ? (\n          <>\n            <TYPE.body my={9} style={{ fontWeight: 400 }}>\n              Because Uniswap V2 uses WETH under the hood, your Uniswap V1 WETH/ETH liquidity cannot be migrated. You\n              may want to remove your liquidity instead.\n            </TYPE.body>\n\n            <ButtonConfirmed\n              onClick={() => {\n                history.push(`/remove/v1/${validatedAddress}`)\n              }}\n            >\n              Remove\n            </ButtonConfirmed>\n          </>\n        ) : userLiquidityBalance && token ? (\n          <V1PairMigration liquidityTokenAmount={userLiquidityBalance} token={token} />\n        ) : (\n          <EmptyState message=\"Loading...\" />\n        )}\n      </AutoColumn>\n    </BodyWrapper>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}